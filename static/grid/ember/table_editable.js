// Generated by CoffeeScript 1.6.3
(function() {
  App.TableEditableExample = Ember.Namespace.create();

  App.TableEditableExample.EditableTableCell = Ember.Table.TableCell.extend({
    classNames: 'editable-table-cell',
    templateName: 'editable-table-cell',
    isEditing: false,
    type: 'text',
    innerTextField: Ember.TextField.extend({
      typeBinding: 'parentView.type',
      valueBinding: 'parentView.cellContent',
      didInsertElement: function() {
        return this.$().focus();
      },
      blur: function(event) {
        return this.set('parentView.isEditing', false);
      }
    }),
    onRowContentDidChange: Ember.observer(function() {
      return this.set('isEditing', false);
    }, 'rowContent'),
    click: function(event) {
      this.set('isEditing', true);
      return event.stopPropagation();
    }
  });

  App.TableEditableExample.DatePickerTableCell = App.TableEditableExample.EditableTableCell.extend({
    type: 'date'
  });

  App.TableEditableExample.RatingTableCell = Ember.Table.TableCell.extend({
    classNames: 'rating-table-cell',
    templateName: 'rating-table-cell',
    didInsertElement: function() {
      this._super();
      return this.onRowContentDidChange();
    },
    applyRating: function(rating) {
      var span;
      this.$('.rating span').removeClass('active');
      span = this.$('.rating span').get(rating);
      return $(span).addClass('active');
    },
    click: function(event) {
      var rating;
      rating = this.$('.rating span').index(event.target);
      if (rating === -1) {
        return;
      }
      this.get('column').setCellContent(this.get('rowContent'), rating);
      return this.applyRating(rating);
    },
    onRowContentDidChange: Ember.observer(function() {
      return this.applyRating(this.get('cellContent'));
    }, 'cellContent')
  });

  App.TableEditableExample.TablesContainer = Ember.Table.TablesContainer.extend(Ember.Table.RowSelectionMixin);

  App.TableEditableExample.TableController = Ember.Table.TableController.extend({
    hasHeader: true,
    hasFooter: false,
    numFixedColumns: 0,
    numRows: 100,
    rowHeight: 30,
    selection: null,
    columns: Ember.computed(function() {
      var columnNames, columns, dateColumn, ratingColumn;
      columnNames = ['event_name', 'disease', 'host', 'location', 'eid_id', 'start_date'];
      dateColumn = Ember.Table.ColumnDefinition.create({
        columnWidth: 100,
        headerCellName: 'Date',
        tableCellViewClass: 'App.TableEditableExample.DatePickerTableCell',
        getCellContent: function(row) {
          return row['start_date'].toString('yyyy-MM-dd');
        },
        setCellContent: function(row, value) {
          return row['start_date'] = value;
        }
      });
      ratingColumn = Ember.Table.ColumnDefinition.create({
        columnWidth: 150,
        headerCellName: 'Analyst Rating',
        tableCellViewClass: 'App.TableEditableExample.RatingTableCell',
        contentPath: 'rating',
        setCellContent: function(row, value) {
          return row['rating'] = value;
        }
      });
      columns = columnNames.map(function(key, index) {
        var name;
        name = key.charAt(0).toUpperCase() + key.slice(1);
        return Ember.Table.ColumnDefinition.create({
          columnWidth: 100,
          headerCellName: name,
          tableCellViewClass: 'App.TableEditableExample.EditableTableCell',
          getCellContent: function(row) {
            return row[key];
          },
          setCellContent: function(row, value) {
            return row[key] = +value;
          }
        });
      });
      return columns;
    }),
    getInitialData: function() {
      var ajx, ret;
      ret = null;
      ajx = $.ajax({
        url: '../../../eid/events',
        async: false,
        dataType: 'json',
        success: function(d) {
          return ret = d;
        }
      });
      return ret;
    },
    content: Ember.computed(function() {
      return this.get('getInitialData')();
    })
  });

}).call(this);
